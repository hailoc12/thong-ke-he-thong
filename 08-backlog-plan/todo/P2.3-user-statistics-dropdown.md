# P2.3: Convert User Statistics Fields to Dropdown

**Priority**: P2 (Enhancement)
**Status**: ‚è≥ TODO
**Category**: Quick Input Enhancement
**Effort**: üîß Small (1-2 hours)
**Created**: 2026-01-20

---

## User Request

> "Th·ªëng k√™ ng∆∞·ªùi d√πng --> chuyen thanh dropdown list voi mot so lua chon pho bien (tu de xuat) --> add vao backlog"

Translation: User statistics ‚Üí convert to dropdown list with some common options (suggest values)

---

## Problem

### Current State

**Fields** (Tab 1 - Th√¥ng tin c∆° b·∫£n):
1. `users_total` - T·ªïng s·ªë ng∆∞·ªùi d√πng (Integer, optional)
2. `users_mau` - Ng∆∞·ªùi d√πng ho·∫°t ƒë·ªông h√†ng th√°ng - MAU (Integer, optional)
3. `users_dau` - Ng∆∞·ªùi d√πng ho·∫°t ƒë·ªông h√†ng ng√†y - DAU (Integer, optional)

**Current UI**: All 3 fields use `<InputNumber>` - free text number input

### Issue

**No Input Guidance**: Users unsure what values are typical for their system scale.

**Data Inconsistency**: Wide variance:
- Some enter: 100 (small internal system)
- Some enter: 50000 (large system)
- Some enter: 1 (clearly wrong)

**Time-consuming**: Must type numbers manually instead of quick select.

**Relationship Unclear**: No indication that DAU < MAU < Total should be true.

---

## Solution

### Recommended Approach: SelectWithOther Dropdown for All 3 Fields

**Convert all 3 fields** to dropdown with predefined ranges + "Kh√°c" ‚Üí custom input

---

### Field 1: users_total (Total Users)

**Predefined Options**:
```typescript
const usersTotalOptions = [
  { label: '< 50 (R·∫•t nh·ªè)', value: '25' },
  { label: '50 - 200 (Nh·ªè)', value: '125' },
  { label: '200 - 1,000 (V·ª´a)', value: '600' },
  { label: '1,000 - 5,000 (L·ªõn)', value: '3000' },
  { label: '5,000 - 20,000 (R·∫•t l·ªõn)', value: '12500' },
  { label: '> 20,000 (Kh·ªïng l·ªì)', value: '30000' },
  { label: 'Kh√°c', value: 'other' },
];
```

---

### Field 2: users_mau (Monthly Active Users)

**Predefined Options**:
```typescript
const usersMAUOptions = [
  { label: '< 50', value: '25' },
  { label: '50 - 200', value: '125' },
  { label: '200 - 1,000', value: '600' },
  { label: '1,000 - 5,000', value: '3000' },
  { label: '5,000 - 15,000', value: '10000' },
  { label: '> 15,000', value: '20000' },
  { label: 'Kh√°c', value: 'other' },
];
```

**Note**: MAU ranges slightly smaller than Total Users (realistic assumption: ~60-80% activation rate)

---

### Field 3: users_dau (Daily Active Users)

**Predefined Options**:
```typescript
const usersDAUOptions = [
  { label: '< 20', value: '10' },
  { label: '20 - 100', value: '60' },
  { label: '100 - 500', value: '300' },
  { label: '500 - 2,000', value: '1250' },
  { label: '2,000 - 10,000', value: '6000' },
  { label: '> 10,000', value: '15000' },
  { label: 'Kh√°c', value: 'other' },
];
```

**Note**: DAU ranges much smaller than MAU (realistic assumption: ~20-30% daily engagement)

---

## Implementation

### Frontend Changes

**File**: `/frontend/src/pages/SystemCreate.tsx` and `SystemEdit.tsx`

**Location**: Tab 1 (Th√¥ng tin c∆° b·∫£n), around lines 620-660

---

#### Change 1: users_total

**Current Code**:
```tsx
<Form.Item
  name="users_total"
  label="T·ªïng s·ªë ng∆∞·ªùi d√πng"
  tooltip="T·ªïng s·ªë ng∆∞·ªùi d√πng ƒë√£ ƒëƒÉng k√Ω/ƒë∆∞·ª£c c·∫•p quy·ªÅn s·ª≠ d·ª•ng h·ªá th·ªëng"
>
  <InputNumber
    style={{ width: '100%' }}
    min={0}
    placeholder="e.g., 500"
  />
</Form.Item>
```

**New Code**:
```tsx
<Form.Item
  name="users_total"
  label="T·ªïng s·ªë ng∆∞·ªùi d√πng"
  tooltip="T·ªïng s·ªë ng∆∞·ªùi d√πng ƒë√£ ƒëƒÉng k√Ω/ƒë∆∞·ª£c c·∫•p quy·ªÅn s·ª≠ d·ª•ng h·ªá th·ªëng"
>
  <SelectWithOther
    options={usersTotalOptions}
    placeholder="Ch·ªçn ph·∫°m vi ho·∫∑c nh·∫≠p s·ªë ch√≠nh x√°c"
    customInputPlaceholder="Nh·∫≠p s·ªë ch√≠nh x√°c (VD: 1250)"
    customInputType="number"
  />
</Form.Item>
```

---

#### Change 2: users_mau

**Current Code**:
```tsx
<Form.Item
  name="users_mau"
  label="Ng∆∞·ªùi d√πng ho·∫°t ƒë·ªông h√†ng th√°ng (MAU)"
  tooltip="Monthly Active Users - S·ªë ng∆∞·ªùi d√πng c√≥ √≠t nh·∫•t 1 l·∫ßn truy c·∫≠p trong th√°ng"
>
  <InputNumber
    style={{ width: '100%' }}
    min={0}
    placeholder="e.g., 300"
  />
</Form.Item>
```

**New Code**:
```tsx
<Form.Item
  name="users_mau"
  label="Ng∆∞·ªùi d√πng ho·∫°t ƒë·ªông h√†ng th√°ng (MAU)"
  tooltip="Monthly Active Users - S·ªë ng∆∞·ªùi d√πng c√≥ √≠t nh·∫•t 1 l·∫ßn truy c·∫≠p trong th√°ng"
>
  <SelectWithOther
    options={usersMAUOptions}
    placeholder="Ch·ªçn ph·∫°m vi ho·∫∑c nh·∫≠p s·ªë ch√≠nh x√°c"
    customInputPlaceholder="Nh·∫≠p s·ªë ch√≠nh x√°c (VD: 850)"
    customInputType="number"
  />
</Form.Item>
```

---

#### Change 3: users_dau

**Current Code**:
```tsx
<Form.Item
  name="users_dau"
  label="Ng∆∞·ªùi d√πng ho·∫°t ƒë·ªông h√†ng ng√†y (DAU)"
  tooltip="Daily Active Users - S·ªë ng∆∞·ªùi d√πng truy c·∫≠p trung b√¨nh m·ªói ng√†y"
>
  <InputNumber
    style={{ width: '100%' }}
    min={0}
    placeholder="e.g., 80"
  />
</Form.Item>
```

**New Code**:
```tsx
<Form.Item
  name="users_dau"
  label="Ng∆∞·ªùi d√πng ho·∫°t ƒë·ªông h√†ng ng√†y (DAU)"
  tooltip="Daily Active Users - S·ªë ng∆∞·ªùi d√πng truy c·∫≠p trung b√¨nh m·ªói ng√†y"
>
  <SelectWithOther
    options={usersDAUOptions}
    placeholder="Ch·ªçn ph·∫°m vi ho·∫∑c nh·∫≠p s·ªë ch√≠nh x√°c"
    customInputPlaceholder="Nh·∫≠p s·ªë ch√≠nh x√°c (VD: 125)"
    customInputType="number"
  />
</Form.Item>
```

---

### Backend Changes

**None required** - fields remain IntegerField, can store midpoint or custom values.

---

## Alternative Solutions

### Option 2: Add Validation for Relationships (Future Enhancement)
```typescript
// Validate: DAU <= MAU <= Total
const validateUserStats = () => {
  const total = form.getFieldValue('users_total');
  const mau = form.getFieldValue('users_mau');
  const dau = form.getFieldValue('users_dau');

  if (dau && mau && dau > mau) {
    message.warning('DAU kh√¥ng n√™n l·ªõn h∆°n MAU');
  }
  if (mau && total && mau > total) {
    message.warning('MAU kh√¥ng n√™n l·ªõn h∆°n T·ªïng s·ªë ng∆∞·ªùi d√πng');
  }
};
```

### Option 3: Smart Suggestions
- If user selects users_total = "1,000 - 5,000"
- Auto-suggest users_mau = "500 - 2,000" (default to ~60% of total)
- Auto-suggest users_dau = "100 - 500" (default to ~20% of MAU)

---

## Testing

### Test Case 1: Select Predefined Range for All 3 Fields
1. Navigate to SystemCreate Tab 1
2. users_total: Select "1,000 - 5,000 (L·ªõn)"
3. users_mau: Select "500 - 2,000"
4. users_dau: Select "100 - 500"
5. Save
6. Expected: Values 3000, 1250, 300 saved to backend

### Test Case 2: Mix Predefined and Custom
1. users_total: Select "1,000 - 5,000 (L·ªõn)" ‚Üí 3000
2. users_mau: Select "Kh√°c" ‚Üí Enter 1827
3. users_dau: Select "Kh√°c" ‚Üí Enter 412
4. Save
5. Expected: Values 3000, 1827, 412 saved

### Test Case 3: Edit Existing System
1. Open system with users_total=280, users_mau=220, users_dau=85
2. Tab 1 ‚Üí user statistics fields
3. Expected:
   - users_total shows "200 - 1,000 (V·ª´a)" OR "Kh√°c" with 280
   - users_mau shows "200 - 1,000" OR "Kh√°c" with 220
   - users_dau shows "20 - 100" OR "Kh√°c" with 85
4. Change users_total to "1,000 - 5,000"
5. Save
6. Expected: Value 3000 saved, others unchanged

### Test Case 4: Optional Fields
1. Leave all 3 fields empty
2. Save
3. Expected: Save succeeds (fields are optional)

---

## Data Migration

**No migration needed** - existing integer values remain valid.

**Display Logic**: Same as annual_users (P2.2):
```typescript
const getClosestRange = (value: number | null, options: {label: string, value: string}[]) => {
  if (value === null) return null;

  // Find closest midpoint
  const midpoints = options
    .filter(opt => opt.value !== 'other')
    .map(opt => parseInt(opt.value));

  const closest = midpoints.reduce((prev, curr) =>
    Math.abs(curr - value) < Math.abs(prev - value) ? curr : prev
  );

  // If within 20% of midpoint, show range; otherwise show "Kh√°c" + custom
  const tolerance = closest * 0.2;
  if (Math.abs(value - closest) <= tolerance) {
    return closest.toString();
  } else {
    return 'other'; // Show "Kh√°c" + custom value
  }
};
```

---

## Related Files

- `/frontend/src/pages/SystemCreate.tsx` (Tab 1, lines ~620-660)
- `/frontend/src/pages/SystemEdit.tsx` (Tab 1, similar)
- `/frontend/src/components/form/SelectWithOther.tsx` (already supports customInputType from P2.2)
- `/backend/apps/systems/models.py` (System model - no change)

---

## Acceptance Criteria

- [ ] users_total field converted to SelectWithOther dropdown
- [ ] users_mau field converted to SelectWithOther dropdown
- [ ] users_dau field converted to SelectWithOther dropdown
- [ ] Each field has 7 options (6 ranges + "Kh√°c")
- [ ] Selecting range saves midpoint integer
- [ ] Selecting "Kh√°c" shows InputNumber for custom input
- [ ] Custom input accepts integers
- [ ] Edit mode: existing values display correctly
- [ ] All 3 fields remain optional
- [ ] Save succeeds with any combination of range/custom/empty
- [ ] TypeScript compilation successful
- [ ] No breaking changes to API

---

## Benefits

### User Experience
- ‚úÖ Faster data entry (3x speedup vs typing numbers)
- ‚úÖ Contextual guidance (range labels show system scale)
- ‚úÖ Consistent across all 3 related fields

### Data Quality
- ‚úÖ More realistic values (ranges prevent extreme outliers)
- ‚úÖ Easier reporting (can group by ranges)
- ‚úÖ Better analytics

### Development
- ‚úÖ Reuses SelectWithOther component (already supports customInputType)
- ‚úÖ No backend changes
- ‚úÖ 100% backward compatible

---

## Future Enhancements (Optional - P3+)

1. **Smart Defaults**: Auto-suggest MAU/DAU based on Total
2. **Validation**: Warn if DAU > MAU or MAU > Total
3. **Charts**: Show distribution of user ranges across all systems
4. **Trends**: Track growth over time (if historical data available)

---

## Estimated Time

- Frontend changes (3 fields √ó 2 files): 45 minutes
- Testing: 20 minutes
- Code review: 10 minutes

**Total**: ~1.25 hours

**Note**: Faster than P2.2 because SelectWithOther with customInputType already exists!
